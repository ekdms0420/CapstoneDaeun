<template>
    <button
      class="obg-n-toggle-button"
      :class="{'disabled':disabled}"
      @click.stop="changeSelectedOption"
    >
      <div class="obg-n-toggle-radio-group"
           :class="radioClassname"
      >
        <div
          class="obg-n-toggle-radio"
          v-if="options.length > 1"
          v-for="(item, i) of options"
          :class="{'selected':isSelected(i)}"
        >
        </div>
      </div>
      <label
        class="obg-n-toggle-text"
      >{{selectedOption}}</label>
    </button>
</template>

<script>
  const MIN_OPTIONS_LEN = 1
  const MAX_OPTIONS_LEN = 3
  /**
   * @see Nissan only
   * @class n-toggle
   * @classdesc components/n-toggle
   * @param {number} [initSelectedIndex=0]
   * @param {array} [options={label: 'label'}] required
   * @param {boolean} [disabled=false]
   *
   * @example
   * <obg-n-toggle
   * :initSelectedIndex='0'
   * :disable="true"
   * :options="['label1', 'label2', {label:'label3'}]]"></obg-n-toggle>
   */
  export default {
    name: 'n-toggle',
    props: {
      initSelectedIndex: {
        type: Number,
        default: 0
      },
      disabled: {
        type: Boolean,
        default: false
      },
      options: {
        type: Array,
        required: true,
        default: [{label: 'label'}],
        validator (arr) {
          arr.map((item) => {
            let type = typeof item
            if (type === 'object') {
              if (!item.label) return false
            } else if (type !== 'string') {
              return false
            }
          })
          return arr.length >= MIN_OPTIONS_LEN && arr.length <= MAX_OPTIONS_LEN
        }
      }
    },
    data () {
      return {
        selectedIndex: 0
      }
    },
    mounted () {
      if (this.initSelectedIndex > -1 && this.initSelectedIndex < this.options.length) {
        this.selectedIndex = this.initSelectedIndex
      }
    },
    computed: {
      selectedOption () {
        let label = this.options[this.selectedIndex]
        if (typeof this.options[this.selectedIndex] === 'object') {
          label = this.options[this.selectedIndex]['label']
        }
        return label
      },
      radioClassname () {
        return 'toggle' + this.options.length + '-radio-group'
      }
    },
    methods: {
      isSelected (index) {
        return index === this.selectedIndex
      },
      changeSelectedOption () {
        if (this.disabled) {
          return
        }
        let nextSelectedIndex = (this.selectedIndex + 1 >= this.options.length) ? 0 : this.selectedIndex + 1
        this.selectedIndex = nextSelectedIndex
        let val = {
          selectedOption: this.options[nextSelectedIndex],
          selectedIndex: nextSelectedIndex
        }
        this.$emit('changed', val)
      }
    }
  }
</script>

<style lang="scss" scoped>
  .obg-list-item.obg-focus, .obg-list-item.obg-focus.large{
    .obg-n-toggle-button{
      background: linear-gradient(#964500, #dc7501);
      &:before{
        background-color: #000;
      }
    }
  }
  .obg-list-item.obg-focus.active, .obg-list-item.obg-focus.large.active{
    .obg-n-toggle-button{
      &:before{
        background-color: #fff;
      }
      label{
        color: #000;
      }
    }
  }
  .obg-n-toggle {
    &-button {
      position: relative;
      display: flex;
      background-color: #333333;
      border-radius: 7px;
      min-width: 250px;
      font-size: 44px;
      height: 56px;
      width: 400px;
      &:before{
        content: '';
        position: absolute;
        top: 3px;
        left: 2px;
        display: block;
        width: calc(100% - 5px);
        height: calc(100% - 5px);
        background: #303030;
        border-radius: 5px;
      }
      &:active, &.active{
        background: linear-gradient(#964500, #dc7501);
        &:before{
          background-color: #fff;
        }
        label{
          color: #000;
        }
      }
      &.disable{
        label{
          color: #787878;
        }
      }
      &.selected{
        label{
          color: #ff8f1c;
        }
      }
      label {
        position: relative;
        float: right;
        width: 100%;
        height: 56px;
        margin-top: -5px;
        padding-right: 33px;
        font-size: 44px;
        text-align: center;
        color: #ffffff;
      }
      &.disabled {
        .obg-n-toggle-text {
          color: grey;
        }
      }
    }
    &-radio {
      border-radius: 100%;
      margin: 3px auto;
      width: 13px;
      height: 13px;
      background-color: #585858;
      &.selected {
        background-color: orange;
      }
    }
    &-radio-group {
      position: relative;
      top: 0;
      float: left;
      margin: auto 11px;
      height: 100%;
    }
  }
  .toggle2-radio-group{
      .obg-n-toggle-radio{
        margin: 7px auto;
      }
  }
</style>
