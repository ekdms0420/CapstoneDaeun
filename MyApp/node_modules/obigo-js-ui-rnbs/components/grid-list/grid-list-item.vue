<template>
    <div class='obg-grid-list-item' :class='{disable: disable}'  @click="handleClick" @mousedown='down' @mouseup='up' @touchstart='down' @touchend='up' @touchcancel='up' @mouseleave='up' @mousecancel='up'  @mousemove='move' @touchmove='move' >
        <slot></slot>
    </div>
</template>

<script>
/**
 * obg-grid-list-item
 * @see Renault, Nissan
 * @class grid-list-item
 * @classdesc components/grid-list
 * @param {boolean} [disable=false]
 * @param {boolean} [clickPropagation=true]
 *
 * @example
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 *
 */
var vertiThreshold = 140
var horiThreshold = 40
export default {
  name: 'obg-grid-list-item',
  vertiThreshold: vertiThreshold,    // static varliable to make scroll
  horiThreshold: horiThreshold,      // static varliable to make scroll
  props: {
    disable: {
      type: Boolean,
      default: false
    },
    clickPropagation: {
      type: Boolean,
      default: true
    }
  },
  methods: {
    down (e) {
      e = e.touches ? e.touches[0] : e
      this.$el.classList.add('active')
      this.clickDownPoint = {
        x: e.clientX,
        y: e.clientY
      }
    },
    up (e) {
      e = e.changedTouches ? e.changedTouches[0] : e
      this.$el.classList.remove('active')
    },
    move (e) {
      e = e.changedTouches ? e.changedTouches[0] : e
      if (this.clickDownPoint) {
        var deltaX = Math.abs(e.clientX - this.clickDownPoint.x)
        var deltaY = Math.abs(e.clientY - this.clickDownPoint.y)

        if (deltaX > horiThreshold || deltaY > vertiThreshold) {
          this.$el.classList.remove('active')
        }
      }
    },
    handleClick (e) {
      this.clickDownPoint = undefined

      this.$emit('click', e)
      var comps = this.$el.querySelectorAll('input, select, button')
      if (comps.length === 1 && this.clickPropagation === true) {
        for (var i = 0; i < comps.length; i++) {
          var ev = document.createEvent('MouseEvents')
          var target = comps[i]
          ev.initMouseEvent('click', false, true, e.view, 1, target.screenX, target.screenY, target.clientX, target.clientY, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, 0, null)
          ev._constructed = true
          target.dispatchEvent(ev)
        }
      }
    }
  }
}
</script>
<style lang="scss" scoped >
/*
@import '../../styles/common/colors.variables';
*/

</style>

